---
- name: install Netplan
  ansible.builtin.apt:
    name:
      - netplan.io
    state: present
    force_apt_get: yes
    update_cache: yes

- name: set Netplan configuration
  ansible.builtin.copy:
    src: "{{ netplan_config|mandatory }}"
    dest: /etc/netplan/config.yaml
    mode: u=rw,g=r,o=r
  notify:
    - netplan apply

- name: disable Cloud-init network configuration
  ansible.builtin.copy:
    src: 99-disable-network-config.cfg
    dest: /etc/cloud/cloud.cfg.d/
    mode: u=rw,g=r,o=r
  when: netplan_cloudinit_disable

- name: remove Netplan configuration generated by Cloud-init
  ansible.builtin.file:
    path: /etc/netplan/50-cloud-init.yaml
    state: absent
  when: netplan_cloudinit_disable
